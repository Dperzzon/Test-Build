var ErrorFixer=pc.createScript("errorFixer");ErrorFixer.prototype.initialize=function(){console.log("ErrorFixer initializing");var e=Object.entries;Object.entries=function safeObjectEntries(r){return null==r?(console.warn("Prevented error: Object.entries called with null/undefined"),[]):e(r)},console.log("Safe Object.entries installed successfully")};var InfoBar=pc.createScript("infobar");InfoBar.attributes.add("title",{type:"string",default:"St. Lars ruin",title:"Title Text"}),InfoBar.attributes.add("subtitle",{type:"string",default:"En tyst väktare över Sigtunas medeltid",title:"Subtitle Text"}),InfoBar.attributes.add("description",{type:"string",default:"Mitt i hjärtat av Sigtuna står den mystiska St. Lars ruin – resterna av en medeltida kyrka som en gång var en av stadens stolta församlingskyrkor. Byggd under 1100-talet i tegel, något ovanligt för sin tid, vittnar ruinen om influenser från kontinenten och stadens tidiga betydelse som religiöst centrum. Trots att kyrkan sedan länge är övergiven, står den kvar som en tyst väktare över historien, där murar täckta av mossa och väderbitna valv viskar om liv, tro och tidens gång. Idag är St. Lars inte bara ett vackert fotoobjekt, utan också en plats för stillhet, reflektion – och en påminnelse om Sveriges allra äldsta stad.",title:"Description Text"}),InfoBar.attributes.add("additionalInfo",{type:"string",false:"Use your mouse or touch to rotate. Scroll to zoom in/out. Pinch to zoom on mobile.",title:"Additional Info"}),InfoBar.attributes.add("startCollapsed",{type:"boolean",default:!1,title:"Start Collapsed"}),InfoBar.attributes.add("collapseDuration",{type:"number",default:.3,title:"Collapse Animation Duration (seconds)"}),InfoBar.prototype.initialize=function(){console.log("InfoBar initializing"),this.createInfoBox(),this.startCollapsed&&this.collapse(!0)},InfoBar.prototype.createInfoBox=function(){console.log("Creating info box");var t=document.getElementById("info-box");t&&t.remove();var e=document.getElementById("info-toggle-button");e&&e.remove();var o=document.createElement("div");o.id="info-box",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.backgroundColor="rgba(80, 80, 80, 0.8)",o.style.borderRadius="0 0 4px 4px",o.style.padding="20px",o.style.color="white",o.style.fontFamily="Arial, sans-serif",o.style.zIndex="10",o.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",o.style.transition=`transform ${this.collapseDuration}s ease-in-out`,o.style.overflow="hidden";var n=document.createElement("div");n.id="info-content",n.style.width="100%",n.style.maxWidth="800px",n.style.margin="0 auto";var i=document.createElement("h1");i.textContent=this.title,i.style.margin="0 0 10px 0",i.style.fontSize="24px",i.style.fontWeight="bold",n.appendChild(i);var s=document.createElement("h2");s.textContent=this.subtitle,s.style.margin="0 0 20px 0",s.style.fontSize="16px",s.style.fontWeight="normal",s.style.color="rgba(255, 255, 255, 0.8)",n.appendChild(s);var l=document.createElement("p");l.textContent=this.description,l.style.margin="0 0 15px 0",l.style.fontSize="14px",l.style.lineHeight="1.5",n.appendChild(l);var a=document.createElement("p");a.textContent=this.additionalInfo,a.style.margin="0",a.style.fontSize="12px",a.style.fontStyle="italic",a.style.color="rgba(255, 255, 255, 0.7)",n.appendChild(a),o.appendChild(n);var r=document.createElement("div");r.id="info-toggle-button",r.style.position="absolute",r.style.top=this.isCollapsed?"0":o.offsetHeight+"px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.width="60px",r.style.height="30px",r.style.backgroundColor="rgba(80, 80, 80, 0.8)",r.style.borderRadius="0 0 4px 4px",r.style.cursor="pointer",r.style.display="flex",r.style.justifyContent="center",r.style.alignItems="center",r.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",r.style.zIndex="11",r.style.transition=`top ${this.collapseDuration}s ease-in-out`;var d=document.createElement("div");d.id="toggle-text",d.textContent="Om",d.style.color="white",d.style.fontSize="14px",d.style.fontWeight="bold",r.appendChild(d),document.body.appendChild(o),document.body.appendChild(r),this.infoBoxElement=o,this.contentContainer=n,this.toggleButton=r,this.toggleText=d,this.isCollapsed=!1;var p=document.createElement("style");p.textContent="\n        @media (max-width: 768px) {\n            #info-box {\n                padding: 10px;\n            }\n            \n            #info-toggle-button {\n                height: 26px;\n                width: 50px;\n            }\n            \n            #toggle-text {\n                font-size: 12px;\n            }\n        }\n    ",document.head.appendChild(p);var u=this;r.onclick=function(t){return t&&(t.preventDefault(),t.stopPropagation()),console.log("Toggle button clicked"),u.toggleCollapse(),!1},r.ontouchstart=function(t){return t&&(t.preventDefault(),t.stopPropagation()),!1},r.ontouchend=function(t){return t&&(t.preventDefault(),t.stopPropagation(),u.toggleCollapse()),!1},r.onmousedown=function(t){return t&&(t.preventDefault(),t.stopPropagation()),!1},o.onclick=o.onmousedown=o.ontouchstart=function(t){return t&&(t.preventDefault(),t.stopPropagation()),!1},console.log("Info box created successfully"),setTimeout((()=>{this.updateTogglePosition()}),10)},InfoBar.prototype.updateTogglePosition=function(){if(this.toggleButton&&this.infoBoxElement)if(this.isCollapsed)this.toggleButton.style.top="0";else{const t=this.infoBoxElement.offsetHeight;this.toggleButton.style.top=t+"px"}},InfoBar.prototype.toggleCollapse=function(){console.log("Toggle collapse called, current state:",this.isCollapsed),this.isCollapsed?this.expand():this.collapse()},InfoBar.prototype.collapse=function(t){if(this.infoBoxElement&&!this.isCollapsed){console.log("Collapsing info box");var e=this.infoBoxElement.offsetHeight;t&&(this.infoBoxElement.style.transition="none",this.toggleButton.style.transition="none",setTimeout((()=>{this.infoBoxElement.style.transition=`transform ${this.collapseDuration}s ease-in-out`,this.toggleButton.style.transition=`top ${this.collapseDuration}s ease-in-out`}),10)),this.infoBoxElement.style.transform=`translateY(-${e}px)`,this.toggleButton.style.top="0",this.isCollapsed=!0}},InfoBar.prototype.expand=function(){this.infoBoxElement&&this.isCollapsed&&(console.log("Expanding info box"),this.infoBoxElement.style.transform="translateY(0)",setTimeout((()=>{this.updateTogglePosition()}),1e3*this.collapseDuration),this.isCollapsed=!1)},InfoBar.prototype.postInitialize=function(){var t=this;this.resizeHandler=function(){setTimeout((()=>{t.updateTogglePosition()}),100)},window.addEventListener("resize",this.resizeHandler)},InfoBar.prototype.hide=function(){this.infoBoxElement&&(this.infoBoxElement.style.display="none",this.toggleButton.style.display="none")},InfoBar.prototype.show=function(){this.infoBoxElement&&(this.infoBoxElement.style.display="block",this.toggleButton.style.display="flex",setTimeout((()=>{this.updateTogglePosition()}),10))},InfoBar.prototype.destroy=function(){this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.infoBoxElement&&this.infoBoxElement.parentNode&&this.infoBoxElement.parentNode.removeChild(this.infoBoxElement),this.toggleButton&&this.toggleButton.parentNode&&this.toggleButton.parentNode.removeChild(this.toggleButton)};var CompassArrow=pc.createScript("compassArrow");CompassArrow.attributes.add("initialDirection",{type:"number",default:180,title:"Initial Direction (degrees)",description:"The initial compass direction in degrees (0 = North, 90 = East, etc.)"}),CompassArrow.attributes.add("arrowSize",{type:"number",default:100,title:"Arrow Size",description:"The size of the compass in pixels"}),CompassArrow.attributes.add("position",{type:"vec2",default:[40,40],title:"Position",description:"The position of the compass from the bottom left (pixels)"}),CompassArrow.attributes.add("compassColor",{type:"rgba",default:[1,1,1,1],title:"Compass Color"}),CompassArrow.attributes.add("northColor",{type:"rgba",default:[1,0,0,1],title:"North Pointer Color"}),CompassArrow.attributes.add("targetEntity",{type:"entity",title:"Target Entity",description:"The entity to track for rotation reference (usually the Camera)"}),CompassArrow.attributes.add("orbitScript",{type:"string",default:"orbitCamera",title:"Orbit Camera Script Name",description:"The name of the orbit camera script"}),CompassArrow.prototype.initialize=function(){this.yaw=0,this.lastYaw=0,this.compassOffset=this.initialDirection,this.debugMode=!1,this.targetEntity||(this.targetEntity=this.app.root.findByName("Camera"),this.targetEntity)?(this.orbitCameraScript=null,this.targetEntity.script&&this.targetEntity.script[this.orbitScript]?(this.orbitCameraScript=this.targetEntity.script[this.orbitScript],this.log("Found orbit camera script")):this.log("No orbit camera script found, will use direct camera rotation"),this.createCompassUI(),window.addEventListener("resize",this.onWindowResize.bind(this)),this.onWindowResize()):console.error("CompassArrow: No camera entity found. Please assign a target entity.")},CompassArrow.prototype.log=function(t){this.debugMode&&console.log("CompassArrow: "+t)},CompassArrow.prototype.createCompassUI=function(){var t=document.getElementById("compass-container");t&&t.remove();var e=document.createElement("div");e.id="compass-container",e.style.position="absolute",e.style.left=this.position.x+"px",e.style.bottom=this.position.y+"px",e.style.width=this.arrowSize+"px",e.style.height=this.arrowSize+"px",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.borderRadius="50%",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="100",e.style.boxShadow="0 3px 8px rgba(0, 0, 0, 0.5)",e.style.border="2px solid rgba(255, 255, 255, 0.5)";var i=document.createElement("div");i.id="compass-face",i.style.width="90%",i.style.height="90%",i.style.borderRadius="50%",i.style.position="relative",i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center",this.createCompassRose(i),this.createDirectionPointer(i),this.addDirectionLabels(i),e.appendChild(i);var o=document.createElement("div");o.id="direction-indicator",o.style.position="absolute",o.style.bottom="-25px",o.style.left="50%",o.style.transform="translateX(-50%)",o.style.color="white",o.style.fontSize="14px",o.style.fontWeight="bold",o.style.backgroundColor="rgba(0, 0, 0, 0.6)",o.style.padding="2px 8px",o.style.borderRadius="10px",e.appendChild(o),document.body.appendChild(e),this.compassElement=i,this.compassContainer=e,this.directionIndicator=o,this.createCompassStyles()},CompassArrow.prototype.createCompassRose=function(t){var e=.9*this.arrowSize,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",e),i.setAttribute("height",e),i.setAttribute("viewBox","0 0 100 100"),i.style.position="absolute",i.id="compass-rose";for(var o=0;o<360;o+=15){var r=o%90==0?35:o%45==0?25:15,s=o%90==0?2:o%45==0?1.5:1,a=document.createElementNS("http://www.w3.org/2000/svg","line"),n=o*Math.PI/180,l=50-r/2,p=50+r/2;a.setAttribute("x1",50+l*Math.sin(n)),a.setAttribute("y1",50-l*Math.cos(n)),a.setAttribute("x2",50+p*Math.sin(n)),a.setAttribute("y2",50-p*Math.cos(n)),a.setAttribute("stroke",this.rgbaToHex(this.compassColor)),a.setAttribute("stroke-width",s),i.appendChild(a)}t.appendChild(i),this.compassRose=i},CompassArrow.prototype.createDirectionPointer=function(t){var e=.9*this.arrowSize,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",e),i.setAttribute("height",e),i.setAttribute("viewBox","0 0 100 100"),i.style.position="absolute",i.id="direction-pointer";var o=document.createElementNS("http://www.w3.org/2000/svg","polygon");o.setAttribute("points","50,15 56,45 50,40 44,45"),o.setAttribute("fill",this.rgbaToHex(this.northColor)),o.setAttribute("stroke","white"),o.setAttribute("stroke-width","1"),i.appendChild(o);var r=document.createElementNS("http://www.w3.org/2000/svg","polygon");r.setAttribute("points","50,85 54,60 50,65 46,60"),r.setAttribute("fill","white"),r.setAttribute("stroke","white"),r.setAttribute("stroke-width","0.5"),i.appendChild(r);var s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("cx","50"),s.setAttribute("cy","50"),s.setAttribute("r","4"),s.setAttribute("fill","white"),i.appendChild(s),t.appendChild(i),this.directionPointer=i},CompassArrow.prototype.addDirectionLabels=function(t){var e=.35*this.arrowSize,i=this.arrowSize/9;[{label:"N",angle:0},{label:"E",angle:90},{label:"S",angle:180},{label:"W",angle:270},{label:"NE",angle:45},{label:"SE",angle:135},{label:"SW",angle:225},{label:"NW",angle:315}].forEach((o=>{var r=document.createElement("div");r.textContent=o.label,r.style.position="absolute",r.style.color="N"===o.label?this.rgbaToHex(this.northColor):"white",r.style.fontSize=1===o.label.length?i+"px":.8*i+"px",r.style.fontFamily="Arial, sans-serif",r.style.fontWeight="bold";var s=o.angle*(Math.PI/180),a=Math.sin(s)*e,n=-Math.cos(s)*e;r.style.transform="translate(-50%, -50%)",r.style.left="calc(50% + "+a+"px)",r.style.top="calc(50% + "+n+"px)",t.appendChild(r)}))},CompassArrow.prototype.createCompassStyles=function(){var t=document.createElement("style");t.textContent="\n        #compass-container {\n            transition: transform 0.3s ease-out;\n        }\n        #compass-container:hover {\n            transform: scale(1.1);\n        }\n        #direction-pointer {\n            transition: transform 0.2s ease-out;\n        }\n        @media (max-width: 768px) {\n            #compass-container {\n                transform: scale(0.8);\n            }\n            #compass-container:hover {\n                transform: scale(0.9);\n            }\n        }\n    ",document.head.appendChild(t)},CompassArrow.prototype.onWindowResize=function(){this.compassContainer&&(this.compassContainer.style.left=this.position.x+"px",this.compassContainer.style.bottom=this.position.y+"px")},CompassArrow.prototype.getCameraYaw=function(){if(this.orbitCameraScript)return this.orbitCameraScript.yaw;var t=new pc.Vec3;if(this.targetEntity.forward.clone(t),t.y=0,0===t.length())return this.lastYaw;t.normalize();var e=Math.atan2(t.x,t.z)*(180/Math.PI);return this.lastYaw=e,e},CompassArrow.prototype.rgbaToHex=function(t){var e=Math.round(255*t.r),i=Math.round(255*t.g),o=Math.round(255*t.b);return"#"+(e<16?"0":"")+e.toString(16)+(i<16?"0":"")+i.toString(16)+(o<16?"0":"")+o.toString(16)},CompassArrow.prototype.degreesToDirection=function(t){for(var e=(t+360)%360,i=[{name:"N",min:337.5,max:360},{name:"N",min:0,max:22.5},{name:"NE",min:22.5,max:67.5},{name:"E",min:67.5,max:112.5},{name:"SE",min:112.5,max:157.5},{name:"S",min:157.5,max:202.5},{name:"SW",min:202.5,max:247.5},{name:"W",min:247.5,max:292.5},{name:"NW",min:292.5,max:337.5}],o=0;o<i.length;o++){var r=i[o];if(r.min<=e&&e<r.max)return r.name}return"N"},CompassArrow.prototype.update=function(t){if(this.compassElement&&this.targetEntity){var e=this.getCameraYaw(),i=-e+this.compassOffset;if(this.debugMode&&Math.abs(i-this._lastLoggedAngle)>10&&(this.log("Camera Yaw: "+e.toFixed(2)+", Compass Angle: "+i.toFixed(2)),this._lastLoggedAngle=i),this.directionPointer.style.transform="rotate("+i+"deg)",this.directionIndicator){var o=(e+180)%360,r=this.degreesToDirection(o),s=Math.round(o);this.directionIndicator.textContent=r+" ("+s+"°)"}}},CompassArrow.prototype.destroy=function(){this.compassContainer&&this.compassContainer.parentNode&&this.compassContainer.parentNode.removeChild(this.compassContainer),window.removeEventListener("resize",this.onWindowResize)};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:100,title:"Max Distance"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:20,title:"Min Distance"}),OrbitCamera.attributes.add("distanceInitial",{type:"number",default:80,title:"Initial Distance"}),OrbitCamera.attributes.add("startYaw",{type:"number",default:0,title:"Initial Yaw (Degrees)"}),OrbitCamera.attributes.add("startPitch",{type:"number",default:30,title:"Initial Pitch (Degrees)"}),OrbitCamera.attributes.add("yawSensitivity",{type:"number",default:.2,title:"Yaw Sensitivity"}),OrbitCamera.attributes.add("pitchSensitivity",{type:"number",default:.2,title:"Pitch Sensitivity"}),OrbitCamera.attributes.add("targetEntity",{type:"entity",title:"Target Entity"}),OrbitCamera.prototype.initialize=function(){this.targetPosition=new pc.Vec3(0,0,0),this.yaw=this.startYaw,this.pitch=this.startPitch,this.minPitch=-40,this.maxPitch=80,this.distance=this.distanceInitial,this.isMouseDown=!1,this.lastPoint=new pc.Vec2,this.isTouching=!1,this.lastTouchPoint=new pc.Vec2,this.uiElementIds=["info-box","info-toggle-button","compass-container"],this.registerInputEvents(),this.targetEntity||(this.targetEntity=this.app.root.findByName("splat3")),this._updatePosition(),console.log("OrbitCamera initialized. Target entity:",this.targetEntity?this.targetEntity.name:"none"),console.log("Initial camera position - Yaw:",this.yaw,"Pitch:",this.pitch,"Distance:",this.distance)},OrbitCamera.prototype.registerInputEvents=function(){this.app.mouse?(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this._onMouseWheel,this)):console.warn("Mouse input not available for OrbitCamera"),this.app.touch?(this.app.touch.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this._onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this._onTouchCancel,this),this.app.touch.on(pc.EVENT_TOUCHSTART,(function(t){t.event&&t.event.preventDefault&&t.event.preventDefault()}))):console.warn("Touch input not available for OrbitCamera"),this.app.keyboard&&this.app.keyboard.on(pc.EVENT_KEYDOWN,this._onKeyDown,this)},OrbitCamera.prototype._isOverUiElement=function(t){var i=t.event?t.event.target:null;if(!i)return!1;for(var e=i;e;){if(e.id&&-1!==this.uiElementIds.indexOf(e.id))return!0;e=e.parentElement}return!1},OrbitCamera.prototype._updatePosition=function(){this.pitch=pc.math.clamp(this.pitch,this.minPitch,this.maxPitch);var t=pc.math.DEG_TO_RAD*this.pitch,i=pc.math.DEG_TO_RAD*this.yaw,e=Math.sin(i),s=Math.cos(i),a=Math.sin(t),o=Math.cos(t),h=this.distance*o*e,n=this.distance*a,c=this.distance*o*s;this.targetEntity&&this.targetPosition.copy(this.targetEntity.getPosition()),this.entity.setLocalPosition(this.targetPosition.x+h,this.targetPosition.y+n,this.targetPosition.z+c),this.entity.lookAt(this.targetPosition);var p=this.targetPosition.y-.1,r=this.entity.getPosition();if(r.y<p){r.y=p,this.entity.setPosition(r);var u=new pc.Vec3;u.sub2(this.targetPosition,r).normalize();var E=Math.asin(u.y)*pc.math.RAD_TO_DEG;Math.abs(this.pitch-E)>.5&&(this.pitch=E)}},OrbitCamera.prototype._onKeyDown=function(t){switch(t.key){case pc.KEY_UP:this.pitch+=5*this.pitchSensitivity;break;case pc.KEY_DOWN:this.pitch-=5*this.pitchSensitivity;break;case pc.KEY_LEFT:this.yaw-=5*this.yawSensitivity;break;case pc.KEY_RIGHT:this.yaw+=5*this.yawSensitivity;break;case pc.KEY_PLUS:case pc.KEY_ADD:this.distance=Math.max(this.distance-.5,this.distanceMin);break;case pc.KEY_MINUS:case pc.KEY_SUBTRACT:this.distance=Math.min(this.distance+.5,this.distanceMax)}},OrbitCamera.prototype._onMouseDown=function(t){this._isOverUiElement(t)||t.button===pc.MOUSEBUTTON_LEFT&&(this.isMouseDown=!0,this.lastPoint.set(t.x,t.y),this.app.mouse.enablePointerLock&&this.app.mouse.enablePointerLock(),t.event&&t.event.preventDefault&&t.event.preventDefault())},OrbitCamera.prototype._onMouseUp=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.isMouseDown=!1,this.app.mouse.disablePointerLock&&this.app.mouse.disablePointerLock())},OrbitCamera.prototype._onMouseMove=function(t){if(this.isMouseDown){var i=t.dx||t.x-this.lastPoint.x,e=t.dy||t.y-this.lastPoint.y;if(0!==i||0!==e){var s=this.pitchSensitivity;(this.pitch<=this.minPitch+5&&e>0||this.pitch>=this.maxPitch-5&&e<0)&&(s*=.5),this.yaw-=i*this.yawSensitivity,this.pitch-=e*s,t.dx||this.lastPoint.set(t.x,t.y)}}},OrbitCamera.prototype._onMouseWheel=function(t){this._isOverUiElement(t)||t.wheel&&(this.distance=pc.math.clamp(this.distance-.5*t.wheel,this.distanceMin,this.distanceMax))},OrbitCamera.prototype._onTouchStart=function(t){this._isOverUiElement(t)||t.touches&&1===t.touches.length&&(this.isTouching=!0,this.lastTouchPoint.set(t.touches[0].x,t.touches[0].y))},OrbitCamera.prototype._onTouchEnd=function(t){this.isTouching=!1},OrbitCamera.prototype._onTouchCancel=function(t){this.isTouching=!1},OrbitCamera.prototype._onTouchMove=function(t){if(!this._isOverUiElement(t)&&this.isTouching&&t.touches&&1===t.touches.length){var i=t.touches[0],e=i.x-this.lastTouchPoint.x,s=i.y-this.lastTouchPoint.y;this.lastTouchPoint.set(i.x,i.y);var a=.5*this.pitchSensitivity;(this.pitch<=this.minPitch+5&&s>0||this.pitch>=this.maxPitch-5&&s<0)&&(a*=.5),this.yaw-=e*this.yawSensitivity*.5,this.pitch-=s*a}},OrbitCamera.prototype.addUiElementToIgnore=function(t){-1===this.uiElementIds.indexOf(t)&&this.uiElementIds.push(t)},OrbitCamera.prototype.update=function(t){this._updatePosition()},OrbitCamera.prototype.destroy=function(){this.app.mouse&&(this.app.mouse.off(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this._onMouseWheel,this)),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHEND,this._onTouchEnd,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this._onTouchMove,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this._onTouchCancel,this)),this.app.keyboard&&this.app.keyboard.off(pc.EVENT_KEYDOWN,this._onKeyDown,this)};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #0c1831;","}","","#application-splash-wrapper {","    position: fixed;","    width: 100%;","    height: 100%;","    top: 0;","    left: 0;","    background-color: #0c1831;","    z-index: 10000;","    display: flex;","    justify-content: center;","    align-items: center;","    font-family: Arial, sans-serif;","    color: white;","}","","#application-splash {","    width: 100%;","    height: 100%;","    display: flex;","    justify-content: center;","    align-items: center;","}","","#loading-container {","    width: 80%;","    max-width: 700px;","}","","#loading-flex-container {","    display: flex;","    align-items: center;","    margin-bottom: 40px;","}","","#logo-container {","    margin-right: 30px;","    min-width: 150px;","}","","#logo-image {","    width: 150px;","    height: auto;","    max-width: 100%;","}","","#text-logo {","    margin-bottom: 10px;","}","","#progress-container {","    flex-grow: 1;","    max-width: 60%;","}","","#progress-label {","    display: flex;","    justify-content: space-between;","    margin-bottom: 8px;","    font-size: 14px;","}","","#progress-percentage {","    font-weight: bold;","    color: #f47425;","}","","#progress-bar-container {","    width: 100%;","    height: 10px;","    background-color: rgba(255, 255, 255, 0.1);","    border-radius: 5px;","    overflow: hidden;","    position: relative;","}","","#progress-bar {","    height: 100%;","    background: linear-gradient(90deg, #f47425, #f47425);","    width: 0%;","    border-radius: 5px;","    transition: width 0.3s ease;","    position: relative;","    animation: pulse 1.5s infinite;","}","","#loading-state {","    font-size: 14px;","    color: rgba(255, 255, 255, 0.6);","    font-style: italic;","    margin-top: 8px;","}","","#loading-message {","    text-align: center;","    font-size: 16px;","    color: rgba(255, 255, 255, 0.7);","    margin-top: 20px;","}","","@keyframes pulse {","    0% { opacity: 0.8; }","    50% { opacity: 1; }","    100% { opacity: 0.8; }","}","","@media (max-width: 600px) {","    #loading-flex-container {","        flex-direction: column;","    }","    ","    #logo-container {","        margin-right: 0;","        margin-bottom: 20px;","    }","    ","    #logo-image {","        width: 100px;","    }","    ","    #progress-container {","        max-width: 100%;","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t);var a=document.createElement("div");a.id="loading-container",t.appendChild(a);var n=document.createElement("div");n.id="loading-flex-container",a.appendChild(n);var i=document.createElement("div");i.id="logo-container",n.appendChild(i);var o=document.createElement("img");o.id="logo-image",o.src="https://launch.playcanvas.com/api/assets/files/221170824/1/splat-reality-logo.png",o.alt="SPLAT REALITY",o.style.width="150px",o.style.height="auto",i.appendChild(o),o.onerror=function(){console.log("Failed to load logo from direct URL, using text fallback"),o.style.display="none";var e=document.createElement("div");e.id="text-logo",e.innerHTML='<span style="color:#f47425; font-weight:bold; font-size:20px;">SPLAT</span> <span style="color:#ffffff; font-weight:bold; font-size:20px;">REALITY</span>',i.appendChild(e)};var r=document.createElement("div");r.id="progress-container",n.appendChild(r);var l=document.createElement("div");l.id="progress-label",r.appendChild(l);var d=document.createElement("span");d.textContent="Splattar din värld till liv...",l.appendChild(d);var p=document.createElement("span");p.id="progress-percentage",p.textContent="0%",l.appendChild(p);var s=document.createElement("div");s.id="progress-bar-container",r.appendChild(s);var c=document.createElement("div");c.id="progress-bar",s.appendChild(c);var g=document.createElement("div");g.id="loading-state",g.textContent="Plockar upp virtuella färgburkar...",r.appendChild(g);var m=document.createElement("div");m.id="loading-message",m.textContent="Låser upp portalen mellan din värld och vår...",a.appendChild(m)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar"),a=document.getElementById("progress-percentage"),n=document.getElementById("loading-state");if(t){e=Math.min(1,Math.max(0,e));var i=Math.round(100*e);if(t.style.width=i+"%",a&&(a.textContent=i+"%"),n){var o="Plockar upp virtuella färgburkar...";if(i<=20)o="Plockar upp virtuella färgburkar...";else if(i<=50)o="Råkade splatta på fel ställe, städar upp...";else if(i<=75)o="Datorn protesterar, förhandlar med processorn...";else if(i<100)o="Nästan klar! Bara en liten justering till...";else{o="Redo att hoppa in!";var r=document.getElementById("loading-message");r&&(r.textContent="Färdigt, klart – dags att splatta loss!")}n.textContent=o}}})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e&&(e.style.transition="opacity 0.5s ease",e.style.opacity="0",setTimeout((function(){e&&e.parentElement&&e.parentElement.removeChild(e)}),500))}))}));var VisitInfoBar=pc.createScript("visitInfoBar");VisitInfoBar.attributes.add("title",{type:"string",default:"Besök St. Lars ruin",title:"Title Text"}),VisitInfoBar.attributes.add("subtitle",{type:"string",default:"Hitta hit",title:"Subtitle Text"}),VisitInfoBar.attributes.add("mapLocation",{type:"string",default:"59.6175,17.7239",title:"Map Coordinates (lat,lng)"}),VisitInfoBar.attributes.add("mapZoom",{type:"number",default:15,title:"Map Zoom Level"}),VisitInfoBar.attributes.add("markerTitle",{type:"string",default:"St. Lars ruin",title:"Marker Title"}),VisitInfoBar.attributes.add("additionalInfo",{type:"string",default:"St. Lars ruin är belägen i centrala Sigtuna och är alltid öppen för besökare.",title:"Additional Info"}),VisitInfoBar.attributes.add("startCollapsed",{type:"boolean",default:!0,title:"Start Collapsed"}),VisitInfoBar.attributes.add("collapseDuration",{type:"number",default:.3,title:"Collapse Animation Duration (seconds)"}),VisitInfoBar.prototype.initialize=function(){console.log("VisitInfoBar initializing"),this.createInfoBox(),this.startCollapsed&&this.collapse(!0)},VisitInfoBar.prototype.createInfoBox=function(){console.log("Creating visit info box");var t=document.getElementById("visit-info-box");t&&t.remove();var e=document.getElementById("visit-toggle-button");e&&e.remove();var o=document.createElement("div");o.id="visit-info-box",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.backgroundColor="rgba(80, 80, 80, 0.8)",o.style.borderRadius="0 0 4px 4px",o.style.padding="20px",o.style.color="white",o.style.fontFamily="Arial, sans-serif",o.style.zIndex="10",o.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",o.style.transition=`transform ${this.collapseDuration}s ease-in-out`,o.style.overflow="hidden";var i=document.createElement("div");i.id="visit-info-content",i.style.width="100%",i.style.maxWidth="800px",i.style.margin="0 auto";var n=document.createElement("h1");n.textContent=this.title,n.style.margin="0 0 10px 0",n.style.fontSize="24px",n.style.fontWeight="bold",i.appendChild(n);var s=document.createElement("h2");s.textContent=this.subtitle,s.style.margin="0 0 20px 0",s.style.fontSize="16px",s.style.fontWeight="normal",s.style.color="rgba(255, 255, 255, 0.8)",i.appendChild(s);var l=document.createElement("div");l.id="map-container",l.style.width="100%",l.style.height="300px",l.style.marginBottom="15px",l.style.backgroundColor="#e5e3df",l.style.borderRadius="4px",i.appendChild(l);this.mapLocation.split(",");var a=document.createElement("iframe");a.width="100%",a.height="100%",a.style.border="0",a.loading="lazy",a.allowFullscreen=!0,a.referrerPolicy="no-referrer-when-downgrade";var r=`https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${this.mapLocation}&zoom=${this.mapZoom}`;a.src=r,l.appendChild(a);var p=document.createElement("p");p.textContent=this.additionalInfo,p.style.margin="0",p.style.fontSize="14px",p.style.lineHeight="1.5",i.appendChild(p);var d=document.createElement("a");d.textContent="Vägbeskrivning via Google Maps",d.href=`https://www.google.com/maps/dir/?api=1&destination=${this.mapLocation}`,d.target="_blank",d.style.display="inline-block",d.style.marginTop="15px",d.style.color="#4eccff",d.style.textDecoration="none",i.appendChild(d),o.appendChild(i);var u=document.createElement("div");u.id="visit-toggle-button",u.style.position="absolute",u.style.top="0",u.style.left="calc(50% + 35px)",u.style.transform="translateX(0)",u.style.width="60px",u.style.height="30px",u.style.backgroundColor="rgba(80, 80, 80, 0.8)",u.style.borderRadius="0 0 4px 4px",u.style.cursor="pointer",u.style.display="flex",u.style.justifyContent="center",u.style.alignItems="center",u.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",u.style.zIndex="11",u.style.transition=`top ${this.collapseDuration}s ease-in-out`;var g=document.createElement("div");g.id="visit-toggle-text",g.textContent="Besök",g.style.color="white",g.style.fontSize="14px",g.style.fontWeight="bold",u.appendChild(g),document.body.appendChild(o),document.body.appendChild(u),this.infoBoxElement=o,this.contentContainer=i,this.toggleButton=u,this.toggleText=g,this.isCollapsed=!1;var h=document.createElement("style");h.textContent="\n        @media (max-width: 768px) {\n            #visit-info-box {\n                padding: 10px;\n            }\n            \n            #visit-toggle-button {\n                height: 26px;\n                width: 60px;\n                left: calc(50% + 30px);\n            }\n            \n            #visit-toggle-text {\n                font-size: 12px;\n            }\n            \n            #map-container {\n                height: 200px;\n            }\n        }\n    ",document.head.appendChild(h);var f=this;u.onclick=function(t){return t&&(t.preventDefault(),t.stopPropagation()),console.log("Visit toggle button clicked"),f.toggleCollapse(),!1},u.ontouchstart=function(t){return t&&(t.preventDefault(),t.stopPropagation()),!1},u.ontouchend=function(t){return t&&(t.preventDefault(),t.stopPropagation(),f.toggleCollapse()),!1},u.onmousedown=function(t){return t&&(t.preventDefault(),t.stopPropagation()),!1},o.onclick=o.onmousedown=o.ontouchstart=function(t){return t&&(t.preventDefault(),t.stopPropagation()),!1},console.log("Visit info box created successfully"),setTimeout((()=>{this.updateTogglePosition()}),10)},VisitInfoBar.prototype.updateTogglePosition=function(){if(this.toggleButton&&this.infoBoxElement)if(this.isCollapsed)this.toggleButton.style.top="0";else{const t=this.infoBoxElement.offsetHeight;this.toggleButton.style.top=t+"px"}},VisitInfoBar.prototype.toggleCollapse=function(){console.log("Visit toggle collapse called, current state:",this.isCollapsed),this.isCollapsed?this.expand():this.collapse()},VisitInfoBar.prototype.collapse=function(t){if(this.infoBoxElement&&!this.isCollapsed){console.log("Collapsing visit info box");var e=this.infoBoxElement.offsetHeight;t&&(this.infoBoxElement.style.transition="none",this.toggleButton.style.transition="none",setTimeout((()=>{this.infoBoxElement.style.transition=`transform ${this.collapseDuration}s ease-in-out`,this.toggleButton.style.transition=`top ${this.collapseDuration}s ease-in-out`}),10)),this.infoBoxElement.style.transform=`translateY(-${e}px)`,this.toggleButton.style.top="0",this.isCollapsed=!0}},VisitInfoBar.prototype.expand=function(){this.infoBoxElement&&this.isCollapsed&&(console.log("Expanding visit info box"),this.infoBoxElement.style.transform="translateY(0)",setTimeout((()=>{this.updateTogglePosition()}),1e3*this.collapseDuration),this.isCollapsed=!1)},VisitInfoBar.prototype.postInitialize=function(){var t=this;this.resizeHandler=function(){setTimeout((()=>{t.updateTogglePosition()}),100)},window.addEventListener("resize",this.resizeHandler)},VisitInfoBar.prototype.hide=function(){this.infoBoxElement&&(this.infoBoxElement.style.display="none",this.toggleButton.style.display="none")},VisitInfoBar.prototype.show=function(){this.infoBoxElement&&(this.infoBoxElement.style.display="block",this.toggleButton.style.display="flex",setTimeout((()=>{this.updateTogglePosition()}),10))},VisitInfoBar.prototype.destroy=function(){this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.infoBoxElement&&this.infoBoxElement.parentNode&&this.infoBoxElement.parentNode.removeChild(this.infoBoxElement),this.toggleButton&&this.toggleButton.parentNode&&this.toggleButton.parentNode.removeChild(this.toggleButton)};var SceneSwitcher=pc.createScript("sceneSwitcher");SceneSwitcher.attributes.add("targetSceneName",{type:"string",title:"Target Scene Name",description:"The name of the scene to load on click (must be in Scene Registry)"}),SceneSwitcher.prototype.initialize=function(){this.entity.element?this.entity.element.on("click",this.onHotspotClick,this):this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.currentSceneName=this.app.scene.name},SceneSwitcher.prototype.onMouseDown=function(e){if(e.button===pc.MOUSEBUTTON_LEFT){var t=this.app.systems.camera.cameras[0].entity,i=t.getPosition(),n=t.camera.screenToWorld(e.x,e.y,t.camera.farClip),o=this.app.systems.rigidbody.raycastFirst(i,n);o&&o.entity===this.entity&&this.onHotspotClick()}},SceneSwitcher.prototype.onHotspotClick=function(){if(this.targetSceneName){console.log("Switching to scene: "+this.targetSceneName);var e=this.app.scene.root,t=this.app.scenes.find(this.targetSceneName);t?this.app.scenes.loadSceneHierarchy(t.url,function(t,i){t?console.error("Error loading scene hierarchy: "+t):(e&&e.destroy(),console.log("Scene '"+this.targetSceneName+"' loaded."))}.bind(this)):console.error("Scene '"+this.targetSceneName+"' not found in Scene Registry.")}else console.warn("Target Scene Name not set for entity: "+this.entity.name)},SceneSwitcher.prototype.onDisable=function(){this.app.mouse&&this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.entity.element&&this.entity.element.off("click",this.onHotspotClick,this)};var FpsController=pc.createScript("fpsController");FpsController.attributes.add("moveSpeed",{type:"number",default:5,title:"Move Speed"}),FpsController.attributes.add("lookSpeed",{type:"number",default:.25,title:"Look Speed"}),FpsController.attributes.add("fixedHeight",{type:"number",default:1.7,title:"Fixed Height (Y)"}),FpsController.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity",description:"The entity holding the camera component."}),FpsController.attributes.add("lookButton",{type:"number",title:"Look Button Code",default:0,description:"Mouse button code: 0 for Left, 1 for Middle, 2 for Right."}),FpsController.prototype.initialize=function(){if(this.eulers=new pc.Vec3,this.movement=new pc.Vec3,this.isLooking=!1,!this.cameraEntity&&(console.warn("FPSController: Camera Entity not assigned!"),this.cameraEntity=this.entity.findByName("CameraHolder"),!this.cameraEntity))return console.error("FPSController: Could not find CameraHolder. Please assign cameraEntity manually."),void(this.enabled=!1);this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),2===this.lookButton&&this.app.mouse.disableContextMenu();var t=this.entity.getPosition();this.entity.setPosition(t.x,this.fixedHeight,t.z),this.eulers.copy(this.cameraEntity.getEulerAngles());var e=this.cameraEntity.getRotation().getEulerAngles();this.entity.setEulerAngles(0,e.y,0),this.eulers.y=this.entity.getEulerAngles().y,this.eulers.x=this.cameraEntity.getLocalEulerAngles().x},FpsController.prototype.update=function(t){var e=this.app,o=0,s=0;if((e.keyboard.isPressed(pc.KEY_A)||e.keyboard.isPressed(pc.KEY_LEFT))&&(o-=1),(e.keyboard.isPressed(pc.KEY_D)||e.keyboard.isPressed(pc.KEY_RIGHT))&&(o+=1),(e.keyboard.isPressed(pc.KEY_W)||e.keyboard.isPressed(pc.KEY_UP))&&(s-=1),(e.keyboard.isPressed(pc.KEY_S)||e.keyboard.isPressed(pc.KEY_DOWN))&&(s+=1),0!==o||0!==s){this.movement.set(o,0,s).normalize().scale(this.moveSpeed*t);var i=this.entity.getPosition(),n=this.entity.forward,r=this.entity.right;i.add(n.clone().mulScalar(-this.movement.z)),i.add(r.clone().mulScalar(this.movement.x)),this.entity.setPosition(i.x,this.fixedHeight,i.z)}this.entity.setEulerAngles(0,this.eulers.y,0),this.cameraEntity.setLocalEulerAngles(this.eulers.x,0,0)},FpsController.prototype.onMouseDown=function(t){t.button===this.lookButton&&(this.isLooking=!0)},FpsController.prototype.onMouseUp=function(t){t.button===this.lookButton&&(this.isLooking=!1)},FpsController.prototype.onMouseMove=function(t){this.isLooking&&(this.eulers.y-=t.dx*this.lookSpeed,this.eulers.y%=360,this.eulers.x-=t.dy*this.lookSpeed,this.eulers.x=pc.math.clamp(this.eulers.x,-89,89))},FpsController.prototype.onDisable=function(){this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),2===this.lookButton&&this.app.mouse.enableContextMenu()};